---
layout: post
title:  "Vue ç»„ä»¶é€šä¿¡"
date:   2022-08-11 20:15:51 +0800
categories: Vue
---

## ğŸ”ºprovide/injectï¼ˆè·¨çº§ç»„ä»¶é€šä¿¡ï¼‰
å…è®¸ä¸€ä¸ªç¥–å…ˆç»„ä»¶å‘å…¶æ‰€æœ‰ä¸è®ºç»„ä»¶å±‚æ¬¡æœ‰å¤šæ·±çš„å­å­™åä»£æ³¨å…¥ä¸€ä¸ªä¾èµ–ã€‚
ç¥–å…ˆç»„ä»¶ä¸­é€šè¿‡provideæ¥æä¾›å˜é‡ï¼Œç„¶ååœ¨å­å­™ç»„ä»¶ä¸­é€šè¿‡injectæ¥æ³¨å…¥å˜é‡ã€‚

1. provideï¼šå¯ä»¥æ˜¯ä¸€ä¸ªå¯¹è±¡æˆ–è€…æ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼ˆè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼‰åŒ…å«å¯ä»¥æ³¨å…¥å­å­™ç»„ä»¶çš„å±æ€§ã€‚
1. injectï¼šä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„æˆ–ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡çš„ key æ˜¯æœ¬åœ°çš„ç»‘å®šåã€‚

value æ˜¯ï¼š
åœ¨å¯ç”¨çš„æ³¨å…¥å†…å®¹ä¸­æœç´¢ç”¨çš„ key ï¼Œæˆ–
ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡çš„ï¼š

-  from å±æ€§  æ˜¯åœ¨å¯ç”¨çš„æ³¨å…¥å†…å®¹ä¸­æœç´¢ç”¨çš„ keyã€‚
-  default å±æ€§  æ˜¯ç›¸å½“äºä¸€ä¸ªé»˜è®¤å€¼
```vue
<template>
  <div>
    <h1>çˆ¶ç»„ä»¶</h1>
    <!-- <child-1-vue :val="info"></child-1-vue> -->
    <child-1-vue></child-1-vue>
  </div>
</template>

<script>
import child1Vue from "./components/child1.vue";
export default {
  data() {
    return {};
  },
  //ä½œä¸ºä¸€ä¸ªå¯¹è±¡
  // provide: {
  //   info: {
  //     uname: "father",
  //     age: 20,
  //   },
  // },

  // ä½œä¸ºä¸€ä¸ªè¿”å›å¯¹è±¡çš„å‡½æ•°
  provide() {
    return {
      obj: {
        uname: "father",
        age: 19,
      },
      info: "789",
    };
  },
  components: {
    child1Vue,
  },
  created() {},

  methods: {},
};
</script>

<style scoped></style>

```
```vue
<template>
  <div>
    <h1>child1ï¼Œå­ç»„ä»¶</h1>
    <p>props:{{ val }}</p>
    <child-2-vue></child-2-vue>
  </div>
</template>

<script>
import child2Vue from "./child2.vue";
export default {
  data() {
    return {};
  },
  props: {
    val: {
      type: String,
    },
  },
  components: {
    child2Vue,
  },
  created() {},

  methods: {},
};
</script>

<style scoped></style>

```
```vue
<template>
  <div>
    <h1>child2ï¼Œå­™å­ç»„ä»¶</h1>
    {{ info }}
    {{ obj.uname }}
  </div>
</template>

<script>
export default {
  data() {
    return {};
  },
  //æ¥æ”¶ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ ---ã€‹'{uname: "father",age: 20,}'
  //   inject: ["info"],

  // æ¥æ”¶ä¸€ä¸ªå¯¹è±¡ ---ã€‹'{uname: "father",age: 19,}'
  inject: {
    obj: {
      form: "obj",
    },
    info: {
      from: "info",
    },
  },
  created() {},

  methods: {},
};
</script>

<style scoped></style>

```

ä½¿ç”¨åœºæ™¯ï¼šå­å­™ç»„ä»¶å’Œç¥–å…ˆç»„ä»¶ä¹‹é—´çš„é€šä¿¡
## ğŸ”º$attrs/$listeners
åœºæ™¯ï¼šå¤šçº§ç»„ä»¶åµŒå¥—éœ€è¦ä¼ é€’æ•°æ®æ—¶ï¼Œä¸”ä¸éœ€è¦å¤„ç†æ•°æ®çš„æ—¶å€™ã€‚

1. $attrs é‡Œå­˜æ”¾çš„æ˜¯çˆ¶ç»„ä»¶ä¸­ç»‘å®šçš„é Props å±æ€§ã€‚
1. $listenersï¼šåŒ…å«äº†çˆ¶ä½œç”¨åŸŸä¸­çš„ (ä¸å« .native ä¿®é¥°å™¨çš„) v-on äº‹ä»¶ç›‘å¬å™¨ã€‚å®ƒå¯ä»¥é€šè¿‡ v-on="$listeners" ä¼ å…¥å†…éƒ¨ç»„ä»¶
```vue
<template>
  <div>
    <p>ç¥–å…ˆç»„ä»¶</p>
    <child-com-1-vue :uname="uname" :age="age" @com1="com1"></child-com-1-vue>
  </div>
</template>

<script>
import childCom1Vue from "./components/childCom1.vue";
export default {
  data() {
    return {
      uname: "ls",
      age: "20",
    };
  },
  components: {
    childCom1Vue,
  },
  created() {},

  methods: {
    com1() {
      console.log("è¿™æ˜¯ç¥–å…ˆç»„ä»¶çš„æ–¹æ³•");
    },
  },
};
</script>

<style scoped></style>

```

```vue
<template>
  <div>
    <p>å­ç»„ä»¶1</p>
    <child-com-2-vue v-bind="$attrs" v-on="$listeners"></child-com-2-vue>
  </div>
</template>

<script>
import childCom2Vue from "./childCom2.vue";
export default {
  data() {
    return {};
  },
  components: {
    childCom2Vue,
  },
  props: {
    uname: {
      type: String,
    },
  },
  created() {
    console.log(this.$attrs); //----{"age":"20"}
    console.log(this.$listeners);
    this.$listeners.com1(); //----â€œè¿™æ˜¯ç¥–å…ˆç»„ä»¶çš„æ–¹æ³•â€
  },

  methods: {},
};
</script>

<style scoped></style>

```
```vue
<template>
  <div>
    <p>å­ç»„ä»¶2</p>
    {{ $attrs }} //---{"age":"20"}
  </div>
</template>

<script>
export default {
  data() {
    return {};
  },

  created() {
    console.log(this.$attrs); //---{"age":"20"}
    this.$listeners.com1(); //----"è¿™æ˜¯ç¥–å…ˆç»„ä»¶çš„æ–¹æ³•"
  },

  methods: {},
};
</script>

<style scoped></style>

```

## $parent,$children
$children ï¼šå¯ä»¥è·å–å½“å‰ç»„ä»¶çš„æ‰€æœ‰å­ç»„ä»¶ï¼Œå¹¶ä¸”ä»¥æ•°ç»„çš„å½¢å¼è¿”å›ã€‚
$parentï¼šå¯ä»¥è·å–å½“å‰ç»„ä»¶çš„çˆ¶ç»„ä»¶ï¼Œå¹¶è¿”å›å½“å‰çˆ¶ç»„ä»¶ã€‚

## ğŸ”ºeventBusï¼ˆäº‹ä»¶æ€»çº¿ï¼‰

1. æœ¬è´¨å°±æ˜¯ä¸€ä¸ªvueå®ä¾‹
1. åˆ›å»º const eventBus = new Vue()
1. å¯¼å‡º export
1. åœ¨ä½¿ç”¨çš„ç»„ä»¶ä¸­å¼•å…¥ import eventBus from ""
1. eventBus.$emit('äº‹ä»¶å'ï¼Œä¼ é€’çš„æ•°æ®)
1. å¦ä¸€ä¸ªç»„ä»¶ä¸­æ³¨å†Œè‡ªå®šä¹‰äº‹ä»¶ eventBus.$on('äº‹ä»¶å'ï¼Œï¼ˆï¼‰=>{})
1. æ¥æ”¶äº‹ä»¶

è®¾è®¡æ¨¡å¼ï¼šå‘å¸ƒè®¢é˜…æ¨¡å¼ï¼šä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œ
    å‘å¸ƒæ–¹ä¸ºä¸€ï¼Œå‘å¸ƒæ¶ˆæ¯ã€‚
   ä¾èµ–æ–¹ä¸ºå¤šï¼Œè®¢é˜…æ¶ˆæ¯ã€‚

```javascript
class eventBus {
	//å®šä¹‰ä¸€ä¸ªæ¥æ”¶äº‹ä»¶çš„å¯¹è±¡
	clientList = {},
	$on = function(event,callback){
		//å¦‚æœæ²¡æœ‰å½“å‰äº‹ä»¶ï¼Œé‚£ä¹ˆå°±ç»™å½“å‰äº‹ä»¶åå½“åšä¸€ä¸ªæ•°ç»„ï¼Œé‡Œé¢å­˜æ”¾äº‹ä»¶å›è°ƒ
		if(!this.clientList[event]){
			this.clientList[event] = []
		}
		//å¦‚æœæœ‰å½“å‰äº‹ä»¶ï¼Œé‚£ä¹ˆå°±ç»™å½“å‰äº‹ä»¶æ•°ç»„æ·»åŠ ä¸€ä¸ªå›è°ƒ
		this.clientList[event].push(callback)
	},
	$emit = function(event,val){
		//æŠŠå¯¹è±¡é‡Œæ¯ä¸ªå±æ€§æ‹¿å‡ºæ¥æ”¾åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ï¼Œéå†æ¯ä¸ªå±æ€§åï¼ˆå³å¯¹è±¡åï¼‰
		Object.keys(this.clientList).forEach(item =>{
			//å¦‚æœæ²¡æœ‰è¯¥äº‹ä»¶ï¼Œå°±è·³å‡º
			if(!this.clientList[event]){
				return false
			}
			
			//ç»™æ¯ä¸ªå±æ€§é‡Œé¢çš„æ¯ä¸ªæ–¹æ³•ä¼ é€’å‚æ•°ã€‚
			this.clientList[event].forEach(callback =>{
				callback(val)
			})
			
		})
	}
}

//new ä¸€ä¸ªäº‹ä»¶æ€»çº¿å®ä¾‹
const event  = new eventBus()
//è®¢é˜…äº‹ä»¶
event.$on('send',(val)=>{
	console.log(val)
})
event.$on('send',(val)=>{
	console.log(val)
})

//å‘å¸ƒäº‹ä»¶,å¹¶ä¸”ç»™å›è°ƒä¼ å‚
event.$emit('send',1)
```
