---
layout: post
title:  "Vue源码"
date:   2022-08-29 19:28:51 +0800
categories: Vue
---

## 一、rollup配置

> vue 库采用 rollup 进行打包
>
> 1. npm init
> 2. 安装依赖
> 3. 配置 rollup.config.js 文件
> 4. 配置 babel
> 5. 添加运行脚本
> 6. 创建 src/index.js
> 7. 创建 public/index.html 

## 二、源码分析

###  1. vue-options

+ 把 data 等数据通过选项对象传递给 Vue 构造函数，构造函数接收参数并传递给`initMixin()`方法,内部通过 `_init()` 接收。
+  `_init()` 中真正的是通过 `initState()` 中的 `initData（）`进行初始化 data 。
+ 判断 data 数据类型，如果是函数，那么就通过 `data.call（vm）`调用，如果是对象，直接返回对象，接下来将要对数据进行劫持。

### 1. 数据劫持

+ 在 `initData()` 中调用 `observer()` 把数据传递过去。
+ 先判断数据是否为对象，不为对象不进行劫持，若为对象则传递到`new Oberver()` 中的`walk()` 中进行对象循环。
+ 再调用`defineReactive()` 对每一个数据劫持，继续调用`obverser()` 对新增的数据进行劫持。
+ 处理直接通过 this 访问到 data 中的数据，在`initData()` 中调用 `proxy()` 对vm进行劫持，当访问vm的数据时，将 vm 上的data代理到 _data 上，再次触发 `observer()` 进行数据劫持。
+ 在`Observer()` 中给需要劫持的数据添加一个 **-ob-** ,标识是否被劫持。 
+ ==数组劫持== 
  + 在`Observer()` 对数组进行判断，如果是数组，则调用`observeArray()` 方法，对数组中的复杂数据类型进行劫持(触发`observer()`) 
  + 重写 7 个数组方法，保留自身功能，对 push、unshift、splice 方法增加的数据进行劫持，最后调用`notify()` 进行通知更新。


![初始化和劫持](https://cdn.jsdelivr.net/gh/TCIano/blog_img/importcdn.png)



